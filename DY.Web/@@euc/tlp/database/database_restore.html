#if (!$isajax)
#parse("pageheader.html")
<script src="js/listtable.js" type="text/javascript"></script>
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>
            还原数据库</h2>
        <ol class="breadcrumb">
            <li><a href="main.aspx">主页</a> </li>
            <li><strong>数据库</strong> </li>
        </ol>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight white-bg">
    #if (!$IsBackup)
    <div class="row">
        <div class="col-lg-12">
            <div class="alert alert-danger alert-dismissable">
                <button aria-hidden="true" data-dismiss="alert" class="close" type="button">
                    ×</button>
                您当前的数据库不支持在线还原。（本功能仅限在SQL2000、SQL2008中使用，请确保您的网站服务器安装了SQL2000，部分SQL2008可以支持在线还原）
            </div>
        </div>
    </div>
    #end
    <div class="row">
        <div class="col-lg-12">
            <div class="alert alert-success alert-dismissable">
                <button aria-hidden="true" data-dismiss="alert" class="close" type="button">
                    ×</button>
                请选择要进行还原的备份文件，数据库备份文件存放于网站根目录的“Backup/Database/”文件夹下，注：由于数据库还原需结束掉所有当前请求数据库的连接，您最好在访客尽量少的情况下执行该操作
            </div>
        </div>
    </div>
</div>
<div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <form method="post" submitdisabledcontrols="true" onsubmit="return backup()" name="listForm" id="listForm">
                    <div id="listDiv" class="ibox-content">
                        #end
                        <table id='list-table' class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                        <th>选择</th>
                                        <th>$SiteUtils.GetSortImg("name","文件名")</th>
                                        <th>$SiteUtils.GetSortImg("size","大小")</th>
                                        <th>$SiteUtils.GetSortImg("creatime","备份时间")</th>
                                        <th></th>
                                </tr>
                            </thead>
                            #foreach($row in $list)
                            <tr>
                                      <td><input name="bak_name" value="${row.name}" type="radio" #if($velocityCount == 0)checked#end /></td>
                                        <td>${row.name}</td>
                                        <td>${row.size} kb</td>
                                        <td>${row.creatime}</td>
                                        <td><a href="/backup/database/${row.name}">下载到本地</a>&nbsp; &nbsp;
                                        <a href="?act=del&file=${row.name}" onclick="return confirm('确认删除当前备份文件吗？')">删除</a></td>
                            </tr>
                            #end
                            #if ($bak_list.Count == 0)
                            <tr>
                                <td colspan="6" align="center" style="color:Red;">当前没有可以进行还原的备份文件</td>
                            </tr>
                            #end
                        </table>
                        <div class="row" id="page-batch">
                            <button class="btn btn-primary btn-sm btnSubmit" type="button" id="submit1" #if ($bak_list.Count == 0)disabled#end>将选定项还原</button>
                        </div>
                        #if (!$isajax)
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
<script type="text/javascript">
function backup()
{
    if (confirm("数据库还原后将不能恢复，你确定要这样做吗？建议先进行数据库备份后再还原"))
    {
        document.getElementById("submit1").value = "数据库正在还原，请稍候...";
        document.getElementById("submit1").disabled = true;
        return true;
    }
    
    return false;
}
</script>
#parse("pagefooter.html")
#end