#parse("pageheader.html")
<h1 id="Menu">
<span class="action-span"><a href="bonus_type.aspx?act=list">优惠券类型</a></span>
<span class="action-span1"><a href="main.aspx">管理中心</a> </span><span id="search_id" class="action-span1"> - 发放优惠券 </span>
<div style="clear:both"></div>
</h1>

<div class="main-div">
<form name="theForm" action="" method="post" onsubmit="return validate();">
<div class="form-div">
<img src="images/icon_search.gif" border="0" alt="SEARCH" />
会员等级：<select name="user_rank">
<option value="0">请选择...</option>
      #foreach($row in $User.GetUserGroupList())
    <option value="$!{row.rank_id}">$!{row.rank_name}</option>
    #end
          </select>
关键字：<input type="text" name="keyword" size="30" />
      <input type="button" name="search" value=" 搜索 " onclick="searchUser();" />
</div>
<div class="list-div">
<table cellspacing='1' cellpadding='3'>
  <tr>
    <th>会员列表：</th>
    <th>操作</th>
    <th>给下列用户发放优惠券</th>
  </tr>
  <tr>
    <td width="45%" align="center">
      <select name="user_search[]" id="user_search" size="15" style="width:260px" ondblclick="addUser()" multiple="true">
      </select>
    </td>
    <td align="center">
      <p><input type="button" value="&gt;" onclick="addUser()" class="button" /></p>
      <p><input type="button" value="&lt;" onclick="delUser()" class="button" /></p>
    </td>
    <td width="45%" align="center">
      <select name="user[]" id="user" multiple="true" size="15" style="width:260px" ondblclick="delUser()">
      </select>
    </td>
  </tr>
  <tr>
    <td align="center" colspan="3"><input type="submit" name="send_user" value="确定发送优惠券" class="button" /></td>
  </tr>
</table>
</div>
<input type="hidden" name="bonus_type_id" value="$id" />
</form>
</div>
 
 
<script language="JavaScript"> 
<!--
document.forms['theForm'].elements['keyword'].focus();
 
/**
* 按用户名搜索用户
*/
function searchUser()
{
  var eles = document.forms['theForm'].elements;
 
  /* 填充列表 */
  var keywords = Utils.trim(eles['keyword'].value);
  if (keywords != '')
  {
      Ajax.call('users.aspx?is_ajax=1&act=search_users', 'q=' + keywords, searchUserResponse, "GET", "JSON");
  }
}
 
function searchUserResponse(result)
{
  var eles = document.forms['theForm'].elements;
  eles['user_search[]'].length = 0;
 
  if (result.error == 0)
  {
    for (i = 0; i < result.content.length; i++)
    {
      var opt = document.createElement('OPTION');
      opt.value = result.content[i].user_id;
      opt.text  = result.content[i].user_name;
      eles['user_search[]'].options.add(opt);
    }
  }
}
 
var submiting = false;
 
function validate()
{
  if(!submiting)
  {
    var idArr = new Array();
    var dest = document.getElementById('user');
    for (var i = 0; i < dest.options.length; i++)
    {
        dest.options[i].selected = "true";
        idArr.push(dest.options[i].value);
    }
    if (idArr.length <= 0)
    {
        alert("用户名不能为空");
        return false;
    }
    else
    {
        submiting = true;
        return true;
    }
  }
  else
  {
    alert('Submitting...');
    return false;
  }
}
 
  function addUser()
  {
      var src = document.getElementById('user_search');
      var dest = document.getElementById('user');
 
      for (var i = 0; i < src.options.length; i++)
      {
          if (src.options[i].selected)
          {
              var exist = false;
              for (var j = 0; j < dest.options.length; j++)
              {
                  if (dest.options[j].value == src.options[i].value)
                  {
                      exist = true;
                      break;
                  }
              }
              if (!exist)
              {
                  var opt = document.createElement('OPTION');
                  opt.value = src.options[i].value;
                  opt.text = src.options[i].text;
                  dest.options.add(opt);
              }
          }
      }
  }
 
  function delUser()
  {
      var dest = document.getElementById('user');
 
      for (var i = dest.options.length - 1; i >= 0 ; i--)
      {
          if (dest.options[i].selected)
          {
              dest.options[i] = null;
          }
      }
  }
 
//-->
</script>
#parse("pagefooter.html")