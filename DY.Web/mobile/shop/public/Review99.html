#if ($type != "list")
<span class="W100P MT10px" id="review-list">正在载入评论数据...</span>
#end
#if ($type == "list")

    <a href="#fbpl" class="CommentB Right" title="我要评论">我要评论</a>
<h1 class="OrangeShadeT MT10px"><strong>用户评论</strong><font>共有<b>$reviewcount</b>条评论</font></h1>
    <ul class="CommentList">
     #foreach($row in $reviewlist)
    <li>
    <span><strong>$row.user_name：</strong><font>$row.add_time</font></span>
    <p>$SiteUtils.StrFormat($row.content)</p>
    #if ($CMS.GetReplyComment($row.comment_id) != "")
    <p style="padding-top:10px;">
        <strong>回复：</strong> $CMS.GetReplyComment($row.comment_id)
    </p>
    #end
    </li>
    <li class="Dashed"></li>
    #end
    </ul>
    #if ($reviewlist.Count == 0)
    <center>
        <span style=" display:block; padding:20px;">现在还没有评论哦。</span>
    </center>
    #else
       <div class="SharePage">
       $pager
       </div>
    #end
#end
#if ($type != "list")
<span class="W100P MT10px">
    <h1 class="ShadeT"><strong>发表评论</strong><a name="fbpl" id="fbpl">&nbsp;</a></h1>
    <div class="Comment">
    <form id="reviewForm" name="reviewForm" action="/tools/ajax.aspx?act=AddReview" method="post" onsubmit="return reviewFormsub(this)">
    <ul>
       <li>用&emsp;户：<input type="text" name="review_name" id="review_name" value="$!username" style="height:18px;"/></li>
       <li>内&emsp;容：<textarea name="review_content" cols="" rows="" id="review_content"></textarea></li>
       <li class="yzm">
         <span>验证码：</span><input type="text" id="captcha" name="captcha" maxlength="4" /><a href="javascript:ReloadCaptcha();"><img src="/tools/verifyimagepage.aspx" class="captcha" style="" /></a>
         <input type="submit" class="SubmitB" value="" />
         <input type="hidden" name="comment_type" value="$!comment_type" />
         <input type="hidden" name="id_value" value="$!id_value" /> 
       </li>
    </ul>
    <p>
       <strong>请注意：</strong><br />
       1.尊重网上道德，遵守中华人民共和国的各项有关法律法规，不发表攻击性言论。<br />
       2.承担一切因您的行为而直接或间接导致的民事或刑事法律责任。<br />
       3.新闻留言板管理人员有权保留或删除其管辖留言中的任意内容。<br />
    </p>
    </form>
    </div>
</span>
<script type="text/javascript">
    $(document).ready(function() {
    LoadReviewList(1);
    });
    //载入评论列表
    function LoadReviewList(pageIndex) {
        jQuery.ajax({
            type: "GET",
            cache:false,
            url: "/tools/ajax.aspx",
            data: "act=GetReviewList&comment_type=$!comment_type&id_value=$!id_value&pageindex=" + pageIndex,
            dataType: "html",
            success: function(data) {
                jQuery('#review-list').html(data);
            }
        });
    }
    function reviewFormsub(form)
    { 
      jQuery(form).ajaxSubmit({
            dataType: 'json',
            beforeSubmit: function() {
                var validator = new Validator("reviewForm");
                validator.required("review_name", "请输入用户昵称！");
                validator.required("review_content", "请输入评论内容！");
                validator.required("captcha", "请输入验证码！");
                return validator.passed();
            },
            success: function(data) {
                if (data.error == 1) {
                    alert(data.message);
                }
                else {
                    alert("您的评论已经成功添加");
                    $('#reviewForm').resetForm();
                    LoadReviewList(1);
                }
            }
        });
       return false;
    }
</script>
#end